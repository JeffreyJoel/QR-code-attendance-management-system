<!DOCTYPE html>
<html>

	<head>

		<meta charset="UTF-8" />
	    <meta name="viewport" content="width=device-width,initial-scale=1" />
	    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

	    <!-- <script type="text/javascript">
	    	let key = localStorage.getItem("admin");

			if (!key) {
				window.location = 'login.html';
			}
			else{
				//console.log(key);
			}
	    </script> -->

	    <title>Exeat portal</title>

	    <link href="https://fonts.googleapis.com/css?family=Nunito:300,400,400i,600,700,800,900" rel="stylesheet" />
	    <link href="./dist-assets/css/themes/lite-purple.min.css" rel="stylesheet" />
	    <link href="./dist-assets/css/plugins/perfect-scrollbar.min.css" rel="stylesheet" />
	    <link rel="stylesheet" href="./dist-assets/css/plugins/dropzone.min.css" />
	    <link rel="stylesheet" href="./dist-assets/css/plugins/style.css" />
	    
	</head>

	<body style="background: url(assets/img/section-bg-101.jpg) no-repeat center center fixed; background-size: cover;">
		<div class="app-admin-wrap layout-horizontal-bar">
			<div class="main-header">
	            <!-- <div class="logo">
	            	<img src="./assets/img/logo_png.png" alt="">
	            </div> -->
	        </div>
			<div class="main-content-wrap d-flex flex-column">
				<div class="main-content">
					<div class="row">
						<div class="col-md-2"></div>
						<div class="col-md-8">
							<div class="breadcrumb">
				                <h1>Request for Exeat</h1>

				                <div style="margin: auto"></div>

				                <div>
				                	<a href="userviewstatus.html">
					                	<button class="btn btn-raised btn-raised-danger m-1" type="button">View Status</button>
					                </a>
					                <button class="btn btn-raised btn-raised-danger m-1" type="button" id="logout">Log Out</button>
				                </div>
				            </div>

			            	<div class="separator-breadcrumb border-top"></div>
			            </div>
			            <div class="col-md-2"></div>
			        </div>

					<form class="row add" id="addfile">
						<div class="col-md-2"></div>
						<div class="col-md-8">
							<div class="card mb-4">
								<div class="card-body">
				            		<div class="input-group mb-3">
				            			<div class="input-group-prepend">
				            				<span class="input-group-text" id="basic-addon3">Category</span>
				            			</div>
				                		<select id="department" class="form-control" name="category">
                                    		<option>Select Category</option>
                                    		<option>Bank Exeat</option>
                                    		<option>Day Exeat</option>
                                    		<option>Long-term Exect</option>
                                		</select>
				            		</div>
				            		<div class="input-group mb-3">
				            			<div class="input-group-prepend">
				            				<span class="input-group-text" id="basic-addon3">Date of arrival</span>
				            			</div>
				                		<input class="form-control" type="datetime-local" name="date" aria-describedby="basic-addon2">
				            		</div>
				            		<div class="input-group mb-3">
				                		<div class="input-group-prepend">
				                			<span class="input-group-text" id="basic-addon3">Reason</span>
				                		</div>
				                		<input class="form-control" id="basic-url" type="text" name="title" aria-describedby="basic-addon3">
				            		</div>
				            		<div class="input-group mb-3">
                                		<div class="custom-file">
                                    		<input class="custom-file-input" id="file" name="file" type="file" aria-describedby="inputGroupFileAddon01">
                                    		<label class="custom-file-label" for="inputGroupFile01">Choose file</label>
                                		</div>
                            		</div>
                            		<!-- <label class="radio radio-danger">
                                		<input type="radio" name="radio" id="active" value="active"><span>Active</span><span class="checkmark"></span>
                            		</label>
                            		<label class="radio radio-danger">
                                		<input type="radio" name="radio" id="inactive" value="inactive"><span>Inactive</span><span class="checkmark"></span>
                            		</label> -->
                            		<button class="btn btn-raised ripple btn-raised-danger m-1" type="submit" id="send">Upload</button>
				        		</div>
				    		</div>
						</div>
						<div class="col-md-2"></div>
					</form>
				</div>
			</div>
		</div>

		<!-- ============ Search UI End ============= -->
	    <script src="./dist-assets/js/plugins/jquery-3.3.1.min.js"></script>
	    <script src="./dist-assets/js/plugins/bootstrap.bundle.min.js"></script>
	    <script src="./dist-assets/js/plugins/perfect-scrollbar.min.js"></script>
	    <script src="./dist-assets/js/scripts/script.min.js"></script>
		
		<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

	    <script type="module">
			// Import the functions you need from the SDKs you need
			import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.3/firebase-app.js";
			import { getDatabase, set, update } from "https://www.gstatic.com/firebasejs/9.9.3/firebase-database.js";
			import { getFirestore, collection, getDocs, addDoc} from "https://www.gstatic.com/firebasejs/9.9.3/firebase-firestore.js";
			import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/9.9.3/firebase-auth.js";
			import { getStorage, ref, getDownloadURL, uploadBytesResumable} from "https://www.gstatic.com/firebasejs/9.9.3/firebase-storage.js";
			// TODO: Add SDKs for Firebase products that you want to use
			// https://firebase.google.com/docs/web/setup#available-libraries

			// Your web app's Firebase configuration
			// For Firebase JS SDK v7.20.0 and later, measurementId is optional
			const firebaseConfig = {
                apiKey: "AIzaSyCgr78LWyUpCnm_ykOWgeZpICpn_jXYgc8",
                authDomain: "authentication-app-2059f.firebaseapp.com",
                databaseURL: "https://authentication-app-2059f-default-rtdb.firebaseio.com",
                projectId: "authentication-app-2059f",
                storageBucket: "authentication-app-2059f.appspot.com",
                messagingSenderId: "937711608289",
                appId: "1:937711608289:web:e17022ca91c64812b732a0"
            };

			// Initialize Firebase
			const app = initializeApp(firebaseConfig);
			const database = getDatabase(app);
			const auth = getAuth();

			let logout = document.getElementById('logout');

			logout.addEventListener('click', (e) => {
				e.preventDefault();

				signOut(auth).then(() => {
					//console.log('Admin logged out!!');
					window.location = 'login.html';

					localStorage.clear();
				  	// Sign-out successful.
				}).catch((error) => {
					// An error happened.
				});
			});


			

			// adding documents
			const addDocument = document.querySelector('.add')
			addDocument.addEventListener('submit', (e) => {
				e.preventDefault();


				addDoc(colRef, {
					category: addDocument.category.value,
					date: addDocument.date.value,
					title: addDocument.title.value,
					file: addDocument.file.value,
					// active: addDocument.active.checked,
					// inactive: addDocument.inactive.checked,
				})
				.then(() => {
					addDocument.reset();
				})
			})

			// deleting documents
			/*const deleteDocument = document.querySelector('.add')
			deleteDocument.addEventListener('submit', (e) => {
				e.preventDefault()
			})*/



			/////////////* Firebase Storage  *///////////
			const storage = getStorage(app);

			var file = [];
			document.getElementById("file").addEventListener("change", function(e) {
				file = e.target.files;
			});


			document.getElementById("send").addEventListener("click", function() {
				//checks if files are selected
				if (file.length != 0) {
					//Loops through all the selected files
					for (let i = 0; i < file.length; i++) {
			
						//create a storage reference
						const storageRef = ref(storage, `/Admin/${file[i].name}`);
				
						//upload file
						const upload = uploadBytesResumable(storageRef, file[i]);
				
						//update progress bar
						upload.on(
							"state_changed",
							function progress(snapshot) {
								var percentage = Math.round((snapshot.bytesTransferred / snapshot.totalBytes) * 100);
								//console.log('Upload is ' + percentage + '% done');
								if (percentage === 100) {
									swal("Uploaded!", "File uploaded!", "success");
									window.location = "admin-view.html";
								} 
								else {
									swal("Uploading!", "File uploading, Don't close window!", "error");
								}
							},
							function error() {
								swal("Error!", "File not uploaded!", "error");
							},
						);
					}
				} else {
					swal("No file!", "No file choosen!", "warning");
				}
			});

			//////////// Firestore //////////////
			const db = getFirestore()

			// collection ref
			const colRef = collection(db, 'admin');

			// get collection data
			getDocs(colRef)
				.then((snapshot) => {
					let admin = [];
					snapshot.docs.forEach((doc) => {
						admin.push({ ...doc.data(), id: doc.id})
					})
					//console.log(admin);
				})
				.catch(err => {
					//console.log(err.message);
				})
			
		</script>
	</body>

</html>