<!DOCTYPE html>
<html>

	<head>

		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	    <meta name="viewport" content="width=device-width,initial-scale=1" />

	    <script type="text/javascript">
	    	let key = localStorage.key(0);

			if ( key ) {
				if ( key === 'admin' ) {
					window.location = 'admin-view.html';
				}
				if ( key === 'super-admin' ) {
					window.location = 'super-admin-view.html';
				}
				if ( key === 'user' ) {
					window.location = 'user-view.html';
				}
			}
	    </script>
	    
	    <title>Login</title>

	    <link href="https://fonts.googleapis.com/css?family=Nunito:300,400,400i,600,700,800,900" rel="stylesheet" />
	    <link href="./dist-assets/css/themes/lite-purple.min.css" rel="stylesheet" />
	    <link rel="stylesheet" href="dist-assets/css/plugins/style.css" />

	</head>

	<body>

		<div class="auth-layout-wrap" style="background: url(assets/img/section-bg-101.jpg) no-repeat center center fixed; background-size: cover;">
    		<div class="auth-content">
		        <div class="card o-hidden">
		            <div class="row">
		                <div class="col-md-6">
		                    <div class="p-4">
		                        <div class="auth-logo text-center mb-4">
		                        	<img src="https://recon.lfcww.org/dist-assets/images/logo.png" alt="">
		                       	</div>
		                       	<div>
		                       		<h1 class="mb-3 text-18">LFCWW DOWNLOAD ADMIN PORTAL</h1>
		                       	</div>

		                        <form>
		                            <div class="form-group">
		                                <label for="email">EMAIL:</label>
		                                <input class="form-control form-control-rounded" id="email" type="email" name="email" required>
		                            </div>
		                            <div class="form-group">
		                                <label for="password">PASSWORD:</label>
		                                <input class="form-control form-control-rounded" id="password" type="password" name="password" required>
		                            </div>
		                            <button class="btn btn-rounded btn-primary btn-block mt-2" id="login" name="login" value="login">Sign In</button>
		                        </form>
		                        <div class="mt-3 text-center">
		                        	<a class="text-muted" id="forgetPassword" href="forgot.html">
		                                <u>Forgot Password?</u>
		                            </a>
		                        </div>
		                    </div>
		                </div>
		                <div class="col-md-6 text-center" style="background-size: cover;background-image: url(https://recon.lfcww.org/dist-assets/images/photo-wide-2.jpg)">
		                    <div class="pr-3 auth-right"></div>
		                </div>
		            </div>
		        </div>
		    </div>
		</div>



		<!-- ============ Search UI End ============= -->
	    <script src="./dist-assets/js/plugins/jquery-3.3.1.min.js"></script>
	    <script src="./dist-assets/js/plugins/bootstrap.bundle.min.js"></script>
	    <script src="./dist-assets/js/plugins/perfect-scrollbar.min.js"></script>
	    <script src="./dist-assets/js/scripts/script.min.js"></script>
	    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

		<script type="module">
			// Import the functions you need from the SDKs you need
			import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-app.js";
			import { getDatabase, set, ref, update } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-database.js";
			import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-auth.js";

			// Your web app's Firebase configuration
			// For Firebase JS SDK v7.20.0 and later, measurementId is optional
			const firebaseConfig = {
				apiKey: "AIzaSyDqMr6gbHWqEcEdigTGM_Sd6AMPlyNfnoM",
				authDomain: "faith-tabernacle.firebaseapp.com",
				databaseURL: "https://faith-tabernacle-default-rtdb.firebaseio.com",
				projectId: "faith-tabernacle",
				storageBucket: "faith-tabernacle.appspot.com",
				messagingSenderId: "647690957744",
				appId: "1:647690957744:web:02b4fd1f099f53cf9f1c75",
				measurementId: "G-WS34NYKQDQ"
			};

			// Initialize Firebase
			const app = initializeApp(firebaseConfig);
			const database = getDatabase(app);
			const auth = getAuth();

			let login = document.getElementById('login');
			

			login.addEventListener('click', (e) => {
				e.preventDefault();
				let email = document.getElementById('email').value;
				let password = document.getElementById('password').value;

				signInWithEmailAndPassword(auth, email, password)
				.then((userCredential) => {
					e.preventDefault();

					/*const dt = new Date();
					update(ref(database, 'users/' + user.uid),{
						last_login: dt,
					})*/

					swal("SUCCESS!", "Succesfully Logged In!", "success");
					//console.log('User logged in!');

					if ( email === 'super.admin@lfcww.org' ) {
						window.location = 'super-admin-view.html';
					}
					else if ( email === 'admin@lfcww.org' ) {
						window.location = 'admin-view.html';
					}
					else {
						window.location = 'user-view.html';
					}
					

					let getRandomString = (length) => {
					    var randomChars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
					    var result = '';
					    for ( var i = 0; i < length; i++ ) {
					        result += randomChars.charAt(Math.floor(Math.random() * randomChars.length));
					    }
					    return result;
					}
					let val = getRandomString(20);

					if ( email === 'super.admin@lfcww.org' ) {
						window.localStorage.setItem('super-admin', JSON.stringify(val));
						//console.log(localStorage.getItem('super-admin'));
					}
					else if ( email === 'admin@lfcww.org' ) {
						window.localStorage.setItem('admin', JSON.stringify(val));
						//console.log(localStorage.getItem('admin'));
					}
					else {
						window.localStorage.setItem('user', JSON.stringify(val));
						//console.log(localStorage.getItem('user'));
					}
					

				})
				.catch((error) => {
					const errorCode = error.code;
					const errorMessage = error.message;

					swal("ERROR!", "Wrong Email or Password!", "error");
				});
			});

		</script>
	</body>

</html>